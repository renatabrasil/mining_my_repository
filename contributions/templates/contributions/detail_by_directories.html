{% extends "base.html" %}
{% load contributions_extra %}

{% block title %}Detalhes dos commits{% endblock %}

{% block content %}
<h3>Commits por diretórios</h3>

<div class="float-right">
    <a class="btn btn-primary" href="{{request.path}}to_csv"><i class="fas sm fa-arrow-alt-circle-down"></i> Exportar para CSV</a>
</div>
<hr>
<div class="table-responsive">
    <table class="table table-striped table-sm">
        <thead class="thead-dark">
            <tr>
                <th></th>
                <th>Author</th>
                <th style="text-align:right">Commit count</th>
                <th style="text-align:right">File count</th>
                <th style="text-align:right">Ownership (commits)</th>
                <th style="text-align:right">Ownership (files)</th>
            </tr>
        </thead>
        <tbody>
            {% if latest_commit_list %}
                {% for directory, infos in latest_commit_list.items %}
                    <tr class="table-light">
                        <td colspan="7">
                                <ul>
                                    <strong>Bird metrics</strong>
                                    <li>Minor contributors: {{infos.minor}}</li>
                                    <li>Major contributors: {{infos.major}}</li>
                                    <li>Ownership: {{infos.ownership|percentage}} </li>
                                </ul>
                                <ul>
                                    <strong>Métricas usadas para classificar tipos de desenvolvedores (JOBLIN et al., 2017)</strong>
                                    <li>Threshold (file): {{infos.core_developers_threshold_file|floatformat:4}}</li>
                                    <li><span style="text-decoration-line: underline">Threshold (commit): {{infos.core_developers_threshold_commit|floatformat:4}}</span></li>
                                </ul>

                            <div class="row justify-content-around">
                                <div class="col-4">
                                  Core developers do diretorio ({{infos.core_developers_commits|length}}):
                                    <br>
                                                        {% for core_dev in infos.core_developers_commits %}
                                                            ({{forloop.counter}}) {{core_dev.name}}{% if not forloop.last %}, {% endif %}
                                                        {% endfor %}
                                </div>
                                <div class="col-7">

                                </div>
                              </div>



                        </td>
                    </tr>
                    <tr class="table-light">
                        <th colspan="7">

                        </th>
                    </tr>
                    <tr class="p-3 mb-2 bg-secondary text-white">
                        <td colspan="7"><strong>{{directory}}</strong></td>
                    </tr>

                    {% for author,contribution in infos.commits_by_author.items %}
                    <tr >
                        <td>{{forloop.counter}}</td>
                        <td><a href="{{request.path}}developers/{{contribution.developer.pk}}?path={{directory}}">{{author.name}}</a> </td>
                        <td style="text-align:right"> {{contribution.commit_count}}</td>
                        <td style="text-align:right"> {{contribution.file_count}}</td>
                        <td style="text-align:right">{{contribution.commit_percentage|percentage}}</td>
                        <td style="text-align:right">{{contribution.file_percentage|percentage}}</td>
                    </tr>
                    {% endfor %}
                    <tr class="p-3 mb-2 bg-info text-white">
                        <th colspan="2">Total:</th>
                        <th style="text-align:right">{{infos.total_commits}}</th>
                        <th style="text-align:right">{{infos.total_java_files}}</th>
                        <td></td>
                        <td></td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="5" style="text-align:center;">No commits are available.</td>
                </tr>
            {% endif %}

        </tbody>
{% endblock %}