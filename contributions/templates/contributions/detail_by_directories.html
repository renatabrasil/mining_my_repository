{% extends "base.html" %}
{% load contributions_extra %}

{% block title %}Detalhes dos commits{% endblock %}

{% block content %}
<h3>Commits por diretórios</h3>

<div class="float-right">
    <a class="btn btn-primary" href="{{request.path}}to_csv"><i class="fas sm fa-arrow-alt-circle-down"></i> Exportar para CSV</a>
</div>
<hr>
<div class="table-responsive">
    <table class="table table-striped table-sm">
         {% if latest_commit_list %}
            {% for directory, infos in latest_commit_list.items %}
                <tr class="table-light">
                    <td colspan="7">
                        <ul>
                            <strong>Bird metrics</strong>
                            <li>Minor contributors: {{infos.minor}}</li>
                            <li>Major contributors: {{infos.major}}</li>
                            <li>Ownership: {{infos.ownership|percentage}} </li>
                        </ul>
                        <ul>
                            <strong>Métricas usadas para classificar tipos de desenvolvedores (JOBLIN et al., 2017)</strong>
                            <li>Threshold (experience): {{infos.core_developers_threshold_experience|floatformat:3}}</li>
                        </ul>

                        <div class="row justify-content-around">
                            <div class="col-4">
                              Core developers do diretorio ({{infos.core_developers_experience|length}}):
                                <br>
                                {% for core_dev in infos.core_developers_experience %}
                                    ({{forloop.counter}}) {{core_dev.name}}{% if not forloop.last %}, {% endif %}
                                {% endfor %}
                            </div>
                            <div class="col-7">

                            </div>
                          </div>
                    </td>
                </tr>
            <thead class="thead-dark">
                <tr>
                    <th></th>
                    <th>Author</th>
                    <th style="text-align:right">Commit count</th>
                    <th style="text-align:right">File count</th>
                    <th style="text-align:right">LOC count</th>
                    <th style="text-align:right" width="12%">Ownership (commits)</th>
                    <th style="text-align:right">Ownership (files)</th>
                    <th style="text-align:right">Ownership (loc)</th>
                    <th style="text-align:right">Experience</th>
                </tr>
            </thead>
            <tbody>
                    <tr class="p-3 mb-2 bg-secondary text-white">
                        <td colspan="9"><strong>{{directory}}</strong></td>
                    </tr>

                    {% for author,contribution in infos.commits_by_author.items %}
                    <tr >
                        <td>{{forloop.counter}}</td>
                        <td><a href="{{request.path}}developers/{{contribution.developer.pk}}?path={{directory}}">{{author.name}}</a> </td>
                        <td style="text-align:right"> {{contribution.commit_count}}</td>
                        <td style="text-align:right"> {{contribution.file_count}}</td>
                        <td style="text-align:right"> {{contribution.loc_count}}</td>
                        <td style="text-align:right">{{contribution.commit_percentage|percentage}}</td>
                        <td style="text-align:right">{{contribution.file_percentage|percentage}}</td>
                        <td style="text-align:right">{{contribution.loc_percentage|percentage}}</td>
                        <td style="text-align:right">{{contribution.experience|floatformat:3}}</td>
                    </tr>
                    {% endfor %}
                    <tr class="p-3 mb-2 bg-info text-white">
                        <th colspan="2">Total:</th>
                        <th style="text-align:right">{{infos.total_commits}}</th>
                        <th style="text-align:right">{{infos.total_java_files}}</th>
                        <th style="text-align:right">{{infos.total_loc}}</th>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="9" style="text-align:center;">No commits are available.</td>
                </tr>
            {% endif %}

        </tbody>
{% endblock %}