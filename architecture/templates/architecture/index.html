{% extends "base.html" %}
{% block title %}Configuração do projeto{% endblock %}

{% block content %}

<div>
  <p>O objetivo desta seção é calcular as métricas para a degradação da arquitetura. Essa é uma das etapas
  da análise de impacto de commits.</p>
  <p>É necessário:</p>
  <ol>
    <li>Gerar informações sobre commits por <a href="/contributions?project=true">projeto</a> e por <a href="/contributions?directories=true">diretorio</a></li> para as tags desejadas
    <li>Gerar lista de commits</li>
    <li>Gerar compiláveis</li>
    <li>Calcular métricas</li>
  </ol>
  <p>Todas essas ações podem demorar vários minutos.</p>
</div>

{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
{% if messages %}
<div class="alert alert-info alert-dismissible fade show" role="alert">
{% for message in messages %}
<p><strong>{{ message }}</strong></p>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
  </button>
</div>

{% endfor %}

{% endif %}

<form action="{% url 'architecture:index' %}" method="post">{% csrf_token %}
  <div class="form-row">
    <div class="col-md-4 mb-3">
      <label>Diretório para salvar os commits e os compilados</label>
      {{ form.directory }}
    </div>
  </div>
  <div class="form-row">
    <div class="col-md-5 mb-3">
      <label>Local do repositório local</label>
      {{ form.git_local_repository }}
    </div>
    <div class="col-md-5 mb-3">
      <label>Diretorio de arquivos compilados no repositório local</label>
      {{ form.build_path }}
    </div>
  </div>
  <input type="hidden" value="1" name="project_id">
  <button class="btn btn-primary" type="submit">Gerar lista de commits</button>
</form>


<hr>

<p>Arquivos no diretório acima:</p>
<div class="alert alert-info" role="alert">
  <p>É importante ter um arquivo de configuração que especifique:</p>
  <ul>
    <li>O diretorio com os arquivos .java</li>
    <li>O diretório com as bibliotecas</li>
    <li>O diretório onde ficarão os .class</li>
  </ul>
  <p>Lembrando que é preciso ter configurado <a href="https://ant.apache.org/manual/install.html">Apache Ant</a>
    e ter colocado a variavel de ambiente ANT_HOME e JAVA_HOME nas variáveis de ambiente. Se o projeto usar o Maven, é necessário fazer o mesmo procedimento para o ele.</p>
  <p>Configurar a variavel de ambiente <strong>JAVA_HOME</strong> e selecionar a versão correta do JDK. É necessário descobrir qual a versão utilizada na versão do software a ser analisado. Esse tipo de informação deve estar em arquivos de configuração.</p>
</div>
<div class="table-responsive">
<table class="table">
  <thead>
    <tr>
      <th scope="col" style="text-align:center">#</th>
      <th scope="col">Arquivo</th>
      <th scope="col">Compilados?</th>
      <th scope="col" style="text-align:center">Ações</th>
    </tr>
  </thead>
  <tbody>
  {% if files %}
  {% for file in files %}
  <tr>
    <td scope="row" style="text-align:center">{{forloop.counter}}</td>
    <td>{{file}}</td>
    <td>{{file.has_compileds}}</td>
    <td style="text-align:center">
      <a href="{% url 'architecture:compileds' file.id %}"><i class="icon ion-md-bug" data-toggle="tooltip" data-placement="right" title="Gerar compiláveis"></i></a> |
      <a href="{% url 'architecture:calculate_architecture_metrics' file.id %}"><i class="fas fa-file-csv" data-toggle="tooltip" data-placement="right" title="Calcular métricas da arquitetura"></i></a> |
      <a href="{% url 'architecture:calculate_metrics' file.id %}"><i class="fas fa-calculator" data-toggle="tooltip" data-placement="right" title="Calcular métricas"></i></a>

    </td>
  </tr>
  {% endfor %}
  {% else %}
    <tr>
      <th scope="row" colspan="3"style="text-align:center">Nenhum arquivo criado neste diretório.</th>
    </tr>

  {% endif %}

  </tbody>
</table>
</div>



{% endblock %}